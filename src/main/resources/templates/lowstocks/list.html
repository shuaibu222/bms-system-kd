<!DOCTYPE html>
<html
    xmlns:th="http://www.thymeleaf.org"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{layout}"
    lang="en">
<head>
    <title>Low Stock Products</title>
    <script>
        // Function to filter products by search query
        function searchProducts() {
            const input = document.getElementById('searchInput');
            const filter = input.value.toLowerCase();
            const table = document.querySelector('table');
            const rows = table.querySelectorAll('tr');

            rows.forEach((row, index) => {
                if (index === 0) return;  // Skip the header row
                const cells = row.querySelectorAll('td');
                let found = false;

                // Iterate over the cells of each row (Product ID, Name, Barcode, etc.)
                cells.forEach(cell => {
                    if (cell.textContent.toLowerCase().includes(filter)) {
                        found = true;
                    }
                });

                // Toggle visibility of rows based on whether they match the filter
                if (found) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }
    </script>
</head>
<body>
    <section layout:fragment="body">
        <article class="list-page">
            <div class="list-header">
                <h1>ðŸ“¦ Low Stock Product List</h1>
            </div>

            <!-- Search bar for filtering products -->
            <div class="search-container">
                <input type="text" id="searchInput" placeholder="ðŸ” Search Products..." onkeyup="searchProducts()">
            </div>

            <div class="table-container">
                <table>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Store</th>
                        <th>Quantity</th>
                        <th>Low Stock Qty</th>
                        <th>Actions</th>
                    </tr>
                    <tr th:each="product : ${products}">
                        <td th:text="${product.id}"></td>
                        <td th:text="${product.name}"></td>
                        <td th:text="${product.store}"></td>
                        <td th:text="${product.quantity}"></td>
                        <td th:text="${product.lowQuantityAlert}"></td>
                        <td>
                            <a class="dynamic-link" th:href="@{'/products/lowstocks/edit/' + ${product.id}}">
                                Restock
                            </a>
                        </td>
                    </tr>
                </table>
            </div>
        </article>
    </section>
</body>
</html>
